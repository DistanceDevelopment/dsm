<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit a density surface model to segment-specific estimates of abundance or density. — dsm • dsm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a density surface model to segment-specific estimates of abundance or density. — dsm"><meta name="description" content="Fits a density surface model (DSM) to detection adjusted counts from a
spatially-referenced distance sampling analysis. dsm takes observations of
animals, allocates them to segments of line (or strip transects) and
optionally adjusts the counts based on detectability using a supplied
detection function model. A generalized additive model, generalized mixed
model or generalized linear model is then used to model these adjusted
counts based on a formula involving environmental covariates."><meta property="og:description" content="Fits a density surface model (DSM) to detection adjusted counts from a
spatially-referenced distance sampling analysis. dsm takes observations of
animals, allocates them to segments of line (or strip transects) and
optionally adjusts the counts based on detectability using a supplied
detection function model. A generalized additive model, generalized mixed
model or generalized linear model is then used to model these adjusted
counts based on a formula involving environmental covariates."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.3.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/data_format/dsm-data-formatting.html">`dsm` data formatting example</a></li>
    <li><a class="dropdown-item" href="../articles/lines_gomex/mexico-analysis.html">Example `dsm` analysis: pantropical dolphins in the Gulf of Mexico</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/distancesamp" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DistanceDevelopment/dsm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit a density surface model to segment-specific estimates of abundance or density.</h1>
      <small class="dont-index">Source: <a href="https://github.com/DistanceDevelopment/dsm/blob/HEAD/R/dsm.R" class="external-link"><code>R/dsm.R</code></a></small>
      <div class="d-none name"><code>dsm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits a density surface model (DSM) to detection adjusted counts from a
spatially-referenced distance sampling analysis. <code>dsm</code> takes observations of
animals, allocates them to segments of line (or strip transects) and
optionally adjusts the counts based on detectability using a supplied
detection function model. A generalized additive model, generalized mixed
model or generalized linear model is then used to model these adjusted
counts based on a formula involving environmental covariates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dsm</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">ddf.obj</span>,</span>
<span>  <span class="va">segment.data</span>,</span>
<span>  <span class="va">observation.data</span>,</span>
<span>  engine <span class="op">=</span> <span class="st">"gam"</span>,</span>
<span>  convert.units <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>keepData <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  availability <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  segment.area <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"REML"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>formula for the surface. This should be a valid formula. See
"Details", below, for how to define the response.</p></dd>


<dt id="arg-ddf-obj">ddf.obj<a class="anchor" aria-label="anchor" href="#arg-ddf-obj"></a></dt>
<dd><p>result from call to <code><a href="https://rdrr.io/pkg/mrds/man/ddf.html" class="external-link">ddf</a></code> or
<code><a href="https://rdrr.io/pkg/Distance/man/ds.html" class="external-link">ds</a></code>. If multiple detection functions are required a <code>list</code>
can be provided. For strip/circle transects where it is assumed all objects
are observed, see <code><a href="dummy_ddf.html">dummy_ddf</a></code>. Mark-recapture distance sampling
(<code>mrds</code>) models of type <code>io</code> (independent observers) and <code>trial</code> are
allowed.</p></dd>


<dt id="arg-segment-data">segment.data<a class="anchor" aria-label="anchor" href="#arg-segment-data"></a></dt>
<dd><p>segment data, see <code><a href="dsm-data.html">dsm-data</a></code>.</p></dd>


<dt id="arg-observation-data">observation.data<a class="anchor" aria-label="anchor" href="#arg-observation-data"></a></dt>
<dd><p>observation data, see <code><a href="dsm-data.html">dsm-data</a></code>.</p></dd>


<dt id="arg-engine">engine<a class="anchor" aria-label="anchor" href="#arg-engine"></a></dt>
<dd><p>which fitting engine should be used for the DSM
(<code>"glm"</code>/<code>"gam"</code>/<code>"gamm"</code>/<code>"bam"</code>).</p></dd>


<dt id="arg-convert-units">convert.units<a class="anchor" aria-label="anchor" href="#arg-convert-units"></a></dt>
<dd><p>conversion factor to multiply the area of the segments
by. See 'Units' below.</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>response distribution (popular choices include
<code><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/Tweedie.html" class="external-link">Tweedie</a></code>/<code><a href="https://rdrr.io/pkg/mgcv/man/Tweedie.html" class="external-link">tw</a></code>
and <code><a href="https://rdrr.io/pkg/mgcv/man/negbin.html" class="external-link">negbin</a></code>/<code><a href="https://rdrr.io/pkg/mgcv/man/negbin.html" class="external-link">nb</a></code>). Defaults
<code><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></code>.</p></dd>


<dt id="arg-group">group<a class="anchor" aria-label="anchor" href="#arg-group"></a></dt>
<dd><p>if <code>TRUE</code> the abundance of <em>groups</em> will be calculated rather
than the abundance of <em>individuals</em>. Setting this option to <code>TRUE</code> is
equivalent to setting the size of each group to be 1.</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>the usual <code>control</code> argument for a <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code>;
<code>keepData</code> must be <code>TRUE</code> for variance estimation to work (though this
option cannot be set for GLMs or GAMMs).</p></dd>


<dt id="arg-availability">availability<a class="anchor" aria-label="anchor" href="#arg-availability"></a></dt>
<dd><p>an estimate of availability bias. For count models used
to multiply the effective strip width (must be a vector of length 1 or
length the number of rows in <code>segment.data</code>); for estimated
abundance/estimated density models used to scale the response (must be a
vector of length 1 or length the number of rows in <code>observation.data</code>).
Uncertainty in the availability is not handled at present.</p></dd>


<dt id="arg-segment-area">segment.area<a class="anchor" aria-label="anchor" href="#arg-segment-area"></a></dt>
<dd><p>if <code>NULL</code> (default) segment areas will be calculated by
multiplying the <code>Effort</code> column in <code>segment.data</code> by the (right minus left)
truncation distance for the <code>ddf.obj</code> or by <code>strip.width</code>. Alternatively a
vector of segment areas can be provided (which must be the same length as
the number of rows in <code>segment.data</code>) or a character string giving the name
of a column in <code>segment.data</code> which contains the areas. If <code>segment.area</code> is
specified it takes precedent.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>weights for each observation used in model fitting. The
default, <code>weights=NULL</code>, weights each observation by its area (see Details).
Setting a scalar value (e.g., <code>weights=1</code>) all observations are equally
weighted.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>The smoothing parameter estimation method. Default is
<code>"REML"</code>, using Restricted Maximum Likelihood. See <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code> for
other options. Ignored for <code>engine="glm"</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>anything else to be passed straight to <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code>,
<code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">gamm</a></code> or <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">gamm</a></code> or
<code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></code> object, with an additional element, <code>$ddf</code> which holds the
detection function object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The response (LHS of <code>formula</code>) can be one of the following (with
restrictions outlined below):</p><ul><li><p><code>count</code> count in each segment</p></li>
<li><p><code>abundance.est</code> estimated abundance per segment, estimation is via a
Horvitz-Thompson estimator</p></li>
<li><p><code>density.est</code> density per segment</p></li>
</ul><p>The offset used in the model is dependent on the response:</p><ul><li><p><code>count</code> area of segment multiplied by average probability of detection
in the segment</p></li>
<li><p><code>abundance.est</code> area of the segment</p></li>
<li><p><code>density</code> zero</p></li>
</ul><p>The <code>count</code> response can only be used when detection function covariates
only vary between segments/points (not within). For example, weather
conditions (like visibility or sea state) or foliage cover are usually
acceptable as they do not change within the segment, but animal sex or
behaviour will not work. The <code>abundance.est</code> response can be used with any
covariates in the detection function.</p>
<p>In the density case, observations can be weighted by segment areas via the
<code>weights=</code> argument. By default (<code>weights=NULL</code>), when density is estimated
the weights are set to the segment areas (using <code>segment.area</code> or by
calculated from detection function object metadata and <code>Effort</code> data).
Alternatively <code>weights=1</code> will set the weights to all be equal. A third
alternative is to pass in a vector of length equal to the number of
segments, containing appropriate weights.</p>
<p>A example analyses are available at <a href="http://examples.distancesampling.org" class="external-link">http://examples.distancesampling.org</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="units">Units<a class="anchor" aria-label="anchor" href="#units"></a></h2>



<p>It is often the case that distances are collected in metres and segment
lengths are recorded in kilometres. <code>dsm</code> allows you to provide a conversion
factor (<code>convert.units</code>) to multiply the areas by. For example: if distances
are in metres and segment lengths are in kilometres setting
<code>convert.units=1000</code> will lead to the analysis being in metres. Setting
<code>convert.units=1/1000</code> will lead to the analysis being in kilometres. The
conversion factor will be applied to <code>segment.area</code> if that is specified.</p>
    </div>
    <div class="section level2">
    <h2 id="large-models">Large models<a class="anchor" aria-label="anchor" href="#large-models"></a></h2>



<p>For large models, <code>engine="bam"</code> with <code>method="fREML"</code> may be useful. Models
specified for <code>bam</code> should be as <code>gam</code>. Read <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></code> before using
this option; this option is considered EXPERIMENTAL at the moment. In
particular note that the default basis choice (thin plate regression
splines) will be slow and that in general fitting is less stable than when
using <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code>. For negative binomial response, theta must be
specified when using <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hedley, S. and S. T. Buckland. 2004. Spatial models for line
transect sampling. JABES 9:181-199.</p>
<p>Miller, D. L., Burt, M. L., Rexstad, E. A., Thomas, L. (2013), Spatial
models for distance sampling data: recent developments and future
directions. Methods in Ecology and Evolution, 4: 1001-1010. doi:
10.1111/2041-210X.12105 (Open Access)</p>
<p>Wood, S.N. 2006. Generalized Additive Models: An Introduction with R.
CRC/Chapman &amp; Hall.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David L. Miller</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DistanceDevelopment/Distance/" class="external-link">Distance</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DistanceDevelopment/dsm" class="external-link">dsm</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load the Gulf of Mexico dolphin data (see ?mexdolphins)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mexdolphins</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a detection function and look at the summary</span></span></span>
<span class="r-in"><span><span class="va">hr.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Distance/man/ds.html" class="external-link">ds</a></span><span class="op">(</span><span class="va">distdata</span>, truncation<span class="op">=</span><span class="fl">6000</span>,</span></span>
<span class="r-in"><span>               key <span class="op">=</span> <span class="st">"hr"</span>, adjustment <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hr.model</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a simple smooth of x and y to counts</span></span></span>
<span class="r-in"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">dsm</span><span class="op">(</span><span class="va">count</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span>, <span class="va">hr.model</span>, <span class="va">segdata</span>, <span class="va">obsdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># predict over a grid</span></span></span>
<span class="r-in"><span><span class="va">mod1.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod1</span>, <span class="va">preddata</span>, <span class="va">preddata</span><span class="op">$</span><span class="va">area</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate the predicted abundance over the grid</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">mod1.pred</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the smooth</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>We improve our site and software support by using Microsoft Clarity to see <br> how you use our website. By using our site, you agree that we and Microsoft <br> can collect and use this data. Clarity is GDPR compliant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>If you wish to donate to development and maintenance, please <a href="mailto:distance@st-andrews.ac.uk">email us</a>.</p>
</div>

    </footer></div>





  </body></html>

