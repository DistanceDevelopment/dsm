<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Variance propagation for density surface models — dsm_varprop • dsm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Variance propagation for density surface models — dsm_varprop"><meta name="description" content="Calculate the uncertainty in predictions from a fitted DSM, including
uncertainty from the detection function."><meta property="og:description" content="Calculate the uncertainty in predictions from a fitted DSM, including
uncertainty from the detection function."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.3.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/data_format/dsm-data-formatting.html">`dsm` data formatting example</a></li>
    <li><a class="dropdown-item" href="../articles/lines_gomex/mexico-analysis.html">Example `dsm` analysis: pantropical dolphins in the Gulf of Mexico</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/distancesamp" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DistanceDevelopment/dsm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Variance propagation for density surface models</h1>
      <small class="dont-index">Source: <a href="https://github.com/DistanceDevelopment/dsm/blob/HEAD/R/dsm_varprop.R" class="external-link"><code>R/dsm_varprop.R</code></a></small>
      <div class="d-none name"><code>dsm_varprop.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate the uncertainty in predictions from a fitted DSM, including
uncertainty from the detection function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dsm_varprop</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  newdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  var.type <span class="op">=</span> <span class="st">"Vp"</span>,</span>
<span>  var_type <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>a fitted <code><a href="dsm.html">dsm</a></code>.</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>the prediction grid. Set to <code>NULL</code> to avoid making
predictions and just return model objects.</p></dd>


<dt id="arg-trace">trace<a class="anchor" aria-label="anchor" href="#arg-trace"></a></dt>
<dd><p>for debugging, see how the scale parameter estimation is going.</p></dd>


<dt id="arg-var-type">var.type<a class="anchor" aria-label="anchor" href="#arg-var-type"></a></dt>
<dd><p>which variance-covariance matrix should be used (<code>"Vp"</code> for
variance-covariance conditional on smoothing parameter(s), <code>"Vc"</code> for
unconditional). See <code><a href="https://rdrr.io/pkg/mgcv/man/gamObject.html" class="external-link">gamObject</a></code> for an details/explanation. If
in doubt, stick with the default, <code>"Vp"</code>.</p></dd>


<dt id="arg-var-type">var_type<a class="anchor" aria-label="anchor" href="#arg-var-type"></a></dt>
<dd><p>deprecated, use <code>var.type</code> instead.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <code>list</code> with elements:</p><ul><li><p><code>old_model</code> fitted model supplied to the function as <code>model</code></p></li>
<li><p><code>refit</code> refitted model object, with extra term</p></li>
<li><p><code>pred</code> point estimates of predictions at <code>newdata</code></p></li>
<li><p><code>var</code> total variance calculated over all of <code>newdata</code></p></li>
<li><p><code>ses</code> standard error for each prediction cell in <code>newdata</code>
if <code>newdata=NULL</code> then the last three entries are <code>NA</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When we make predictions from a spatial model, we also want to know the
uncertainty about that abundance estimate. Since density surface models are
2 (or more) stage models, we need to incorporate the uncertainty from the
earlier stages (i.e. the detection function) into our "final" uncertainty
estimate.</p>
<p>This function will refit the spatial model but include the Hessian of the
offset as an extra term. Variance estimates using this new model can then be
used to calculate the variance of predicted abundance estimates which
incorporate detection function uncertainty. Importantly this requires that
if the detection function has covariates, then these do not vary within a
segment (so, for example covariates like sex cannot be used).</p>
<p>For more information on how to construct the prediction grid <code>data.frame</code>,
<code>newdata</code>, see <code><a href="predict.dsm.html">predict.dsm</a></code>.</p>
<p>This routine is only useful if a detection function with covariates has been
used in the DSM.</p>
<p>Note that we can use <code>var.type="Vc"</code> here (see <code>gamObject</code>), which is the
variance-covariance matrix for the spatial model, corrected for smoothing
parameter uncertainty. See Wood, Pya &amp; S\"afken (2016) for more
information.</p>
<p>Models with fixed scale parameters (e.g., negative binomial) do not require
an extra round of optimisation.</p>
    </div>
    <div class="section level2">
    <h2 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a></h2>


<p>The summary output from the function includes a simply diagnostic that shows
the average probability of detection from the "original" fitted model (the
model supplied to this function; column <code>Fitted.model</code>) and the probability
of detection from the refitted model (used for variance propagation; column
<code>Refitted.model</code>) along with the standard error of the probability of
detection from the fitted model (<code>Fitted.model.se</code>), at the unique values of
any factor covariates used in the detection function (for continuous
covariates the 5%, 50% and 95% quantiles are shown). If there are large
differences between the probabilities of detection then there are
potentially problems with the fitted model, the variance propagation or
both. This can be because the fitted model does not account for enough of
the variability in the data and in refitting the variance model accounts for
this in the random effect.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bravington, M. V., Miller, D. L., &amp; Hedley, S. L. (2021). Variance
Propagation for Density Surface Models. Journal of Agricultural, Biological
and Environmental Statistics. https://doi.org/10.1007/s13253-021-00438-2</p>
<p>Williams, R., Hedley, S.L., Branch, T.A., Bravington, M.V., Zerbini, A.N.
and Findlay, K.P. (2011). Chilean Blue Whales as a Case Study to Illustrate
Methods to Estimate Abundance and Evaluate Conservation Status of Rare
Species. Conservation Biology 25(3), 526-535.</p>
<p>Wood, S.N., Pya, N. and S\"afken, B. (2016) Smoothing parameter and model
selection for general smooth models. Journal of the American Statistical
Association, 1-45.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>David L. Miller, based on code from Mark V. Bravington and Sharon L.
Hedley.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>We improve our site and software support by using Microsoft Clarity to see <br> how you use our website. By using our site, you agree that we and Microsoft <br> can collect and use this data. Clarity is GDPR compliant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>If you wish to donate to development and maintenance, please <a href="mailto:distance@st-andrews.ac.uk">email us</a>.</p>
</div>

    </footer></div>





  </body></html>

