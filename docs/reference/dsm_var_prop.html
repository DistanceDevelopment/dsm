<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Prediction variance propagation for DSMs — dsm_var_prop • dsm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prediction variance propagation for DSMs — dsm_var_prop"><meta name="description" content="To ensure that uncertainty from the detection function is correctly
propagated to the final variance estimate of abundance, this function uses a
method first detailed in Williams et al (2011), further explanation is given
in Bravington et al. (2021)."><meta property="og:description" content="To ensure that uncertainty from the detection function is correctly
propagated to the final variance estimate of abundance, this function uses a
method first detailed in Williams et al (2011), further explanation is given
in Bravington et al. (2021)."><script type="text/javascript"> (function(c,l,a,r,i,t,y){ c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)}; t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i; y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window, document, "clarity", "script","maw5mo10ad");</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/data_format/dsm-data-formatting.html">`dsm` data formatting example</a></li>
    <li><a class="dropdown-item" href="../articles/lines_gomex/mexico-analysis.html">Example `dsm` analysis: pantropical dolphins in the Gulf of Mexico</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/distancesamp" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/DistanceDevelopment/dsm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Prediction variance propagation for DSMs</h1>
      <small class="dont-index">Source: <a href="https://github.com/DistanceDevelopment/dsm/blob/HEAD/R/dsm_var_prop.R" class="external-link"><code>R/dsm_var_prop.R</code></a></small>
      <div class="d-none name"><code>dsm_var_prop.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>To ensure that uncertainty from the detection function is correctly
propagated to the final variance estimate of abundance, this function uses a
method first detailed in Williams et al (2011), further explanation is given
in Bravington et al. (2021).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dsm_var_prop</span><span class="op">(</span></span>
<span>  <span class="va">dsm.obj</span>,</span>
<span>  <span class="va">pred.data</span>,</span>
<span>  <span class="va">off.set</span>,</span>
<span>  seglen.varname <span class="op">=</span> <span class="st">"Effort"</span>,</span>
<span>  type.pred <span class="op">=</span> <span class="st">"response"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dsm-obj">dsm.obj<a class="anchor" aria-label="anchor" href="#arg-dsm-obj"></a></dt>
<dd><p>a model object fitted by <code><a href="dsm.html">dsm</a></code>.</p></dd>


<dt id="arg-pred-data">pred.data<a class="anchor" aria-label="anchor" href="#arg-pred-data"></a></dt>
<dd><p>either: a single prediction grid or list of prediction
grids. Each grid should be a <code>data.frame</code> with the same columns as the
original data.</p></dd>


<dt id="arg-off-set">off.set<a class="anchor" aria-label="anchor" href="#arg-off-set"></a></dt>
<dd><p>a a vector or list of vectors with as many elements as there
are in <code>pred.data</code>. Each vector is as long as the number of rows in the
corresponding element of <code>pred.data</code>. These give the area associated with
each prediction cell. If a single number is supplied it will be replicated
for the length of <code>pred.data</code>.</p></dd>


<dt id="arg-seglen-varname">seglen.varname<a class="anchor" aria-label="anchor" href="#arg-seglen-varname"></a></dt>
<dd><p>name for the column which holds the segment length
(default value <code>"Effort"</code>).</p></dd>


<dt id="arg-type-pred">type.pred<a class="anchor" aria-label="anchor" href="#arg-type-pred"></a></dt>
<dd><p>should the predictions be on the "response" or "link"
scale? (default <code>"response"</code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <code>list</code> with elements</p><ul><li><p><code>model</code> the fitted model object</p></li>
<li><p><code>pred.var</code> variance of each region given in <code>pred.data</code></p></li>
<li><p><code>bootstrap</code> logical, always <code>FALSE</code></p></li>
<li><p><code>pred.data</code> as above</p></li>
<li><p><code>off.set</code> as above</p></li>
<li><p><code>model</code> the fitted model with the extra term</p></li>
<li><p><code>dsm.object</code> the original model, as above</p></li>
<li><p><code>model.check</code> simple check of subtracting the coefficients of the two
models to see if there is a large difference</p></li>
<li><p><code>deriv</code> numerically calculated Hessian of the offset</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The idea is to refit the spatial model but including an extra random effect.
This random effect has zero mean and hence to effect on point estimates. Its
variance is the Hessian of the detection function. Variance estimates then
incorporate detection function uncertainty. Further mathematical details are
given in the paper in the references below.</p>
<p>Many prediction grids can be supplied by supplying a list of <code>data.frame</code>s
to the function.</p>
<p>Note that this routine simply calls <code><a href="dsm_varprop.html">dsm_varprop</a></code>. If you
don't require multiple prediction grids, the other routine will probably be
faster.</p>
<p>This routine is only useful if a detection function with covariates has been
used in the DSM.</p>
    </div>
    <div class="section level2">
    <h2 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a></h2>


<p>The summary output from the function includes a simply diagnostic that shows
the average probability of detection from the "original" fitted model (the
model supplied to this function; column <code>Fitted.model</code>) and the probability
of detection from the refitted model (used for variance propagation; column
<code>Refitted.model</code>) along with the standard error of the probability of
detection from the fitted model (<code>Fitted.model.se</code>), at the unique values of
any factor covariates used in the detection function (for continuous
covariates the 5%, 50% and 95% quantiles are shown). If there are large
differences between the probabilities of detection then there are
potentially problems with the fitted model, the variance propagation or
both. This can be because the fitted model does not account for enough of
the variability in the data and in refitting the variance model accounts for
this in the random effect.</p>
    </div>
    <div class="section level2">
    <h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a></h2>


<p>Note that this routine is only useful if a detection function has been used
in the DSM. It cannot be used when the <code>abundance.est</code> or <code>density.est</code>
responses are used. Importantly this requires that if the detection function
has covariates, then these do not vary within a segment (so, for example
covariates like sex cannot be used).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bravington, M. V., Miller, D. L., &amp; Hedley, S. L. (2021). Variance
Propagation for Density Surface Models. Journal of Agricultural, Biological
and Environmental Statistics. https://doi.org/10.1007/s13253-021-00438-2</p>
<p>Williams, R., Hedley, S.L., Branch, T.A., Bravington, M.V., Zerbini, A.N.
and Findlay, K.P. (2011). Chilean Blue Whales as a Case Study to Illustrate
Methods to Estimate Abundance and Evaluate Conservation Status of Rare
Species. Conservation Biology 25(3), 526-535.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Mark V. Bravington, Sharon L. Hedley. Bugs added by David L. Miller.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>We improve our site and software support by using Microsoft Clarity to see <br> how you use our website. By using our site, you agree that we and Microsoft <br> can collect and use this data. Clarity is GDPR compliant.</p>
</div>

<div class="pkgdown-footer-right">
  <p>If you wish to donate to development and maintenance, please <a href="mailto:distance@st-andrews.ac.uk">email us</a>.</p>
</div>

    </footer></div>





  </body></html>

